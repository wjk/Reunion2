<Project>
  <ItemGroup>
    <AvailableItemName Include="Manifest" />
  </ItemGroup>

  <Target Name="GetNativeReferencesFromVcxproj" AfterTargets="ResolveProjectReferences">
    <MSBuild Projects="@(_MSBuildProjectReferenceExistent)" Targets="BuiltProjectOutputGroup;BuiltProjectOutputGroupDependencies" Condition="'%(Extension)' == '.vcxproj'">
      <Output TaskParameter="TargetOutputs" ItemName="ContentFromVcxproj" />
    </MSBuild>

    <ItemGroup>
      <Content Include="@(ContentFromVcxproj)">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
      </Content>
    </ItemGroup>
  </Target>

  <!-- ============== NativeAOT ============== -->

  <ItemGroup>
    <AvailableItemName Include="RdXmlFile" />
  </ItemGroup>
  
  <!-- ============== CsWinRT ============== -->

  <Target Name="CsWinRTGetReferenceWinMDFiles" BeforeTargets="CsWinRTGenerateProjection">
    <PropertyGroup>
      <_NativePlatform Condition="'$(Platform)' == 'x86' or '$(Platform)' == 'AnyCPU'">Win32</_NativePlatform>
      <_NativePlatform Condition="'$(_NativePlatform)' == ''">$(Platform)</_NativePlatform>
    </PropertyGroup>

    <MSBuild Projects="@(_MSBuildProjectReferenceExistent)" Targets="Build" Condition="'%(_MSBuildProjectReferenceExistent.CsWinRTSource)' == 'true'"
             Properties="Platform=$(_NativePlatform);Configuration=$(Configuration)">
      <Output TaskParameter="TargetOutputs" ItemName="CsWinRTProjectOutputs" />
    </MSBuild>

    <ItemGroup>
      <CSWinRTInputs Include="@(CsWinRTProjectOutputs)" Condition="'%(Extension)' == '.winmd'" />
    </ItemGroup>
  </Target>

  <!-- ============== Visual Studio for Mac compatiblity ============== -->

  <ItemGroup>
    <KnownFrameworkReference Update="@(KnownFrameworkReference)">
      <IsWindowsOnly>false</IsWindowsOnly>
    </KnownFrameworkReference>
  </ItemGroup>

  <!-- ============== Code Signing ============== -->
  <Import Project="signing\CodeSigning.targets" />
</Project>
